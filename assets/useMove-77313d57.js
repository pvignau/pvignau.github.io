import{R as f,b,r as u,u as m,a as r,c as T,j as w,m as L,d as S,e as c,f as E,g as $,h as H,k as M,l as D,n as R}from"./index-4417abf3.js";function k(t=f){const e=t===f?b:()=>u.useContext(t);return function(){const{store:i}=e();return i}}const C=k();function P(t=f){const e=t===f?C:k(t);return function(){return e().dispatch}}const x=P();var h={},O={get exports(){return h},set exports(t){h=t}};O.exports=v;h.isMobile=v;h.default=v;const B=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,N=/CrOS/,I=/android|ipad|playbook|silk/i;function v(t){t||(t={});let e=t.ua;if(!e&&typeof navigator<"u"&&(e=navigator.userAgent),e&&e.headers&&typeof e.headers["user-agent"]=="string"&&(e=e.headers["user-agent"]),typeof e!="string")return!1;let o=B.test(e)&&!N.test(e)||!!t.tablet&&I.test(e);return!o&&t.tablet&&t.featureDetect&&navigator&&navigator.maxTouchPoints>1&&e.indexOf("Macintosh")!==-1&&e.indexOf("Safari")!==-1&&(o=!0),o}const y=h();function j(t){const{hero:e}=m(a=>a.hero),[o,i]=u.useState(!1),[l,s]=u.useState(0),d=x();T.useEffect(()=>{const a=()=>{l<e.speech.length-1?s(l+1):d(S()),window.removeEventListener("keydown",a),window.removeEventListener("touchstart",a)};return setTimeout(()=>{i(!0),window.addEventListener("keydown",a),window.addEventListener("touchstart",a)},1e3),()=>{window.removeEventListener("keydown",a),window.removeEventListener("touchstart",a)}});const n=y?"Touch screen":"Press any key";return w("dialog",{className:"bubble",open:!0,children:[r("p",{children:e.speech[l]}),o&&r("div",{className:"hint",children:n})]})}function A(t){const{hero:e}=m(l=>l.hero),o=x(),i=()=>{o(L([y?"Gross... do not touch me !":"Outch ! It hurts !","Don't do that !"]))};return r("div",{id:"hero",className:`hero ${e.isMoving?"walk":""} ${e.direction.toLowerCase()}`,style:{top:`${e.position.y}px`,left:`${e.position.x}px`},onClick:i,children:e.isTalking&&r(j,{})})}function F(t){return r("div",{className:`${t.type} tile`,style:{top:t.y+"px",left:t.x+"px"}})}const U=function(t){return{x:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)/2-(t.position.x+28/2),y:Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)/2-(t.position.y+32/2)}};function z(t){const e=m(s=>s.map),{hero:o}=m(s=>s.hero);let i=[];t.debug&&(i=[...e.tiles.map(s=>r(F,{type:(s==null?void 0:s.meta.action)==="redirect"?"door":"collision",x:s.x,y:s.y},s.x+"-"+s.y))]);const l=U(o);return w("div",{className:"map",style:{width:`${e.size.width}px`,height:`${e.size.height}px`,top:`${l.y}px`,left:`${l.x}px`},children:[r("img",{src:e.background,alt:"map"}),t.debug&&r("div",{className:"collisions-tiles",children:i}),t.children]})}function W(t){return r("div",{className:"game-container",children:r(z,{debug:window.debug,children:r(A,{})})})}const G="/assets/loader-71be96dd.svg";class V extends u.Component{constructor(e){super(e),this.hint="This will show up when page is loading."}componentDidMount(){var o,i;const e=[];(o=this.props)!=null&&o.assetsToLoad&&Promise.all((i=this.props)==null?void 0:i.assetsToLoad).then(l=>{const s=l.map(d=>new Promise(n=>{e[d.default]=new Image,e[d.default].addEventListener("load",()=>{n(e[d.default])}),e[d.default].src=d.default}));Promise.all(s).then(()=>c.dispatch(E(!1)))})}render(){return r("div",{children:w("div",{id:"loader",children:[r("img",{src:G,alt:"loader display"}),r("p",{className:"hint hidden",children:this.hint})]})})}}const g=function(t,e){return t.x<=e.x+36&&t.x+24>=e.x&&t.y<=e.y+12&&t.y+36>=e.y},p={getTiles(){return c.getState().map.tiles},getHeroFuturePosition(t,e){switch(t){case"up":return{...c.getState().hero.hero.position,y:c.getState().hero.hero.position.y-e};case"down":return{...c.getState().hero.hero.position,y:c.getState().hero.hero.position.y+e};case"left":return{...c.getState().hero.hero.position,x:c.getState().hero.hero.position.x-e};case"right":return{...c.getState().hero.hero.position,x:c.getState().hero.hero.position.x+e}}return c.getState().hero.hero.position},getUpBlockingTile(t){const e=this.getTiles();for(let o=0;o<e.length;o++)if(g(this.getHeroFuturePosition("up",t),e[o]))return e[o];return null},getDownBlockingTile(t){const e=this.getTiles();for(let o=0;o<e.length;o++)if(g(this.getHeroFuturePosition("down",t),e[o]))return e[o];return null},getLeftBlockingTile(t){const e=this.getTiles();for(let o=0;o<e.length;o++)if(g(this.getHeroFuturePosition("left",t),e[o]))return e[o];return null},getRightBlockingTile(t){const e=this.getTiles();for(let o=0;o<e.length;o++)if(g(this.getHeroFuturePosition("right",t),e[o]))return e[o];return null}},q=()=>{const t=x(),[e,o]=u.useState(void 0),i=u.useMemo(()=>[],[]);return u.useEffect(()=>{const l=()=>{let n=null;switch(i[i.length-1]){case"ArrowDown":n=p.getDownBlockingTile(12),n===null&&t(D()),n&&n.meta.action==="redirect"&&(window.location.href=n.meta.value);break;case"ArrowLeft":n=p.getLeftBlockingTile(12),n===null&&t(M()),n&&n.meta.action==="redirect"&&(window.location.href=n.meta.value);break;case"ArrowUp":n=p.getUpBlockingTile(12),n===null&&t(H()),n&&n.meta.action==="redirect"&&(window.location.href=n.meta.value);break;case"ArrowRight":n=p.getRightBlockingTile(12),n===null&&t($()),n&&n.meta.action==="redirect"&&(window.location.href=n.meta.value);break}},s=n=>{i.indexOf(n.key)===-1&&i.push(n.key)},d=n=>{for(let a=0;a<i.length;a++)i[a]===n.key&&i.splice(a,1);i.length===0&&t(R())};return window.addEventListener("keydown",s),window.addEventListener("keyup",d),e===void 0&&o(setInterval(l,100)),()=>{i.length=0,window.removeEventListener("keydown",s),window.removeEventListener("keyup",d),clearInterval(e)}},[t,e,i]),[c.getState().hero.hero.position]};export{V as L,W as M,q as a,x as u};
